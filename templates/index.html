<!DOCTYPE html>
<html>
<head>
  <title>NPM A.I</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='NPMaistyle.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <header class="header">NPM A.I.</header>

  <video autoplay muted loop id="background-video">
    <source src="https://npmexplorer.netlify.app/NPM%20ai%20backgrond%20video.mp4" type="video/mp4">
  </video>
  <div id="video-overlay"></div>

  <h2>NPM A.I ask anything</h2>

  <p>AI:</p>
  <p id="response"></p>

  <div class="stickdiv">
    <input type="text" id="userInput" placeholder="Type your question here..." />
    <button onclick="askAI()">Send</button>
    <button onclick="startListening()">üé§ Speak</button>
  </div> 

<script>
function startListening() {
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "en-IN"; // "hi-IN" for Hindi
    recognition.interimResults = false;

    recognition.onstart = () => {
        document.getElementById("userInput").placeholder = "üéôÔ∏è Listening...";
    };

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("userInput").value = transcript;
        document.getElementById("userInput").placeholder = "Type your question here...";
        askAI(); // auto-send after speech
    };

    recognition.onerror = (event) => {
        alert("üé§ Voice error: " + event.error);
        document.getElementById("userInput").placeholder = "Type your question here...";
    };

    recognition.start();
}

async function askAI() {
    const input = document.getElementById("userInput").value.trim();
    const responseBox = document.getElementById("response");

    if (!input) {
        responseBox.textContent = "‚ùó Please type something!";
        return;
    }

    responseBox.textContent = "üß† Thinking...";

    try {
        const res = await fetch("/NPMai-ask", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt: input })
        });

        const data = await res.json();
        responseBox.textContent = data.response;
        speak(data.response);

    } catch (err) {
        responseBox.textContent = "‚ùå Failed to get AI response.";
        console.error(err);
    }
}

function speak(text) {
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = "en-IN";
    msg.rate = 0.95;
    speechSynthesis.speak(msg);
}
</script>
</body>
</html>
